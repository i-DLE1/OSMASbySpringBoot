<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layouts/layout}">

<head>
    <meta charset="UTF-8">
    <title>공지사항 등록</title>
    <script src="/js/admin/adminBoard.js"></script>
    <link rel="stylesheet" href="/css/admin/adminmypage/adminbasicstyle.css">
    <link rel="stylesheet" href="/css/admin/adminmypage/adminmainstyle.css">
    <!-- include summernote css/js-->
    <!-- include libraries(jQuery, bootstrap) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- include summernote css/js -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
</head>
<body>

<header id="header">
    <div th:include="~{/common/fragments/header}"></div>
</header>

<!--공지사항 카테고리 -->
<div class="">
    <nav class="box3">
        <ul style="border-bottom: none; border-top: none;">
            <li class="box" th:style="${type == 'A' ? 'background-color: #bea376;':''}"><a th:href="@{/admin/user_notice/notice_view/A}">전체보기</a></li>
            <li class="box" th:style="${type == 'N' ? 'background-color: #bea376;':''}"><a th:href="@{/admin/user_notice/notice_view/N}">공지사항</a></li>
            <li class="box" th:style="${type == 'E' ? 'background-color: #bea376;':''}"><a th:href="@{/admin/user_notice/notice_view/E}">이벤트</a></li>
            <li class="box" th:style="${type == 'AT' ? 'background-color: #bea376;':''}"><a th:href="@{/admin/user_notice/notice_view/AT}">보도자료</a></li>
            <!-- 관리자 일때 공지사항 등록 버튼 보이게 -->
            <th:block sec:authorize="hasRole('ADMIN')">
                <div style="text-align: center;">
                    <a th:href="@{/admin/admin_notice/notice_registration}" class="btn5" style="padding-top: 5px;">공지사항 등록</a>
                </div>
                <script th:inline="javascript">
                    var refmemberno = /*[[${#authentication.principal.no}]]*/ '';
                </script>
            </th:block>
        </ul>
    </nav>
</div>

<!--공지사항 등록 본문 -->
<th:block layout:fragment="content">
    <div class="registration">
        <br>
        <br>
        <h1 class="notice3">공지사항 등록</h1>
        <hr>
        <br>
        <br>
    </div>

    <form id="boardRegistForm" th:action="@{/admin/user_notice/admin_notice/notice_registration}" method="post">
        <table>
            <tr>
                <td class="w-px160" style="font-size: 16px;">카테고리</td>
                <td>
                    <select name="categoryCode" style="font-size: 16px;" id="category">
                        <option value="공지사항">공지사항</option>
                        <option value="이벤트">이벤트</option>
                        <option value="보도자료">보도자료</option>
                    </select>
                </td>
            </tr>

            <tr>
                <th class="w-px160" style="font-size: 16px;">제목</th>
                <td><input type="text" name="title" class="need" style="width: 575px;" id="title"></td>
            </tr>

            <tr>
                <th style="font-size: 16px;">내용</th>
                <td><textarea name="content" class="need" rows="1" cols="80" id="summernote"></textarea></td>
            </tr>



            <tr>
                <th class="w-px160" style="font-size: 16px;">파일 첨부</th>
                <td class="left">
                    <label>
                        <input type="file" name="file" id="attach-file"/>
                    </label>
                    <span id="file-name"></span>
                    <span id="delete-file" style="color: red; margin-left: 20px;"><i class="fas fa-times font-img"></i></span>
                </td>
            </tr>
        </table>


<!--        <div style="width: 60%; margin: auto;">-->
<!--            <input type="text" name="title" style="width: 40%;" placeholder="제목" th:value="${title}"/>-->
<!--            <br><br>-->
<!--            <textarea id="summernote" name="content" th:text="${content}"></textarea>-->
<!--            <input id="subBtn" type="submit" value="글 수정" style="float: right;"/>-->
<!--        </div>-->

    </form>

    <div class="btnSet">
        <br>
        <button type="button" onclick="location.href='/admin/user_notice/notice_view/A'">취소</button>
        <button type="button" onclick="save()">저장</button>
    </div>
</th:block>

<script>
    $(document).ready(function() {
        $('#summernote').summernote({
            placeholder: '내용',
            minHeight: 370,
            maxHeight: null,
            focus: true,
            lang: 'ko-KR'
        });

        // 등록된 공지사항의 내용을 수정하여 태그 구조 변경
        function modifyHTMLStructure(htmlString) {
            var div = document.createElement("div");
            div.innerHTML = htmlString;

            var paragraphs = div.getElementsByTagName("p");
            for (var i = 0; i < paragraphs.length; i++) {
                var paragraph = paragraphs[i];
                var fontTags = paragraph.getElementsByTagName("font");
                for (var j = 0; j < fontTags.length; j++) {
                    var fontTag = fontTags[j];
                    var span = document.createElement("span");
                    span.innerHTML = fontTag.innerHTML;
                    span.style.color = fontTag.getAttribute("color");
                    span.style.backgroundColor = fontTag.style.backgroundColor;
                    paragraph.replaceChild(span, fontTag);
                }
            }

            return div.innerHTML;
        }


        // 공지사항 등록 페이지의 저장 버튼
        function save() {
            var category = $('#category').val();
            var title = $('#title').val();
            var content = $('#summernote').val();

            // AJAX 요청 보내기
            $.ajax({
                url: '/admin/admin_notice/notice_registration',
                type: 'POST',
                data: JSON.stringify({
                    category: category,
                    title: title,
                    content: content
                }),
                contentType: 'application/json',
                success: function(response) {
                    alert('등록되었습니다.');
                    location.href = '/admin/user_notice/notice_view/A';
                },
                error: function(xhr, status, error) {
                    alert('등록에 실패했습니다. 오류 메시지: ' + error);
                }
            });
        }
    });
</script>


<footer>
    <div th:include="~{/common/fragments/footer}"></div>
</footer>

</body>
</html>